–í–æ—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –∫–ª–∞—Å—Å–æ–≤, –≤ –∫–æ—Ç–æ—Ä—É—é —è **–≤—Å—Ç—Ä–æ–∏–ª –ª–æ–≥–∏–∫—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è —Å—á—ë—Ç—á–∏–∫–æ–≤**, –∞ —Ç–∞–∫–∂–µ **—Ä–∞–±–æ—Ç—É —Å —Ñ–∞–π–ª–∞–º–∏** (–ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã—Ö–æ–¥–∞).

---

## üß© –û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –∫–ª–∞—Å—Å–æ–≤

```mermaid
classDiagram

    class MainWindow {
        -currentFilePath: QString
        -isModified: bool
        -meterTableView: QTableWidget*
        -controller: MeterController*

        +MainWindow()
        +setupUi()
        +connectSignalsAndSlots()

        -loadFromFile(path: QString)
        -saveToFile(path: QString = "")
        -closeEvent(event: QCloseEvent*)
        -dragEnterEvent(event: QDragEnterEvent*)
        -dropEvent(event: QDropEvent*)

        -deleteSelectedRow()
    }

    class AddMeterDialog {
        +exec(): int
        +getType(): QString
        +getDate(): QString
        +getValue(): float
        +getParam(): QString
    }

    class MeterController {
        -fileHandler: FileHandler*
        -meters: MeterList

        +addMeter(meter: unique_ptr<AbstractMeter>)
        +removeMeter(index: size_t)
        +loadFromFile(path: QString)
        +saveToFile(path: QString)
        +getMeters(): const MeterList&
    }

    class MeterListView {
        -table: QTableWidget*

        +updateView(list: MeterList)
        +selectedRow(): int
    }

    class FileHandler {
        +loadFromFile(path: QString): MeterList
        +saveToFile(path: QString, data: MeterList)
        -detectFormat(path: QString): IFileFormat*
    }

    class IFileFormat {
        <<interface>>
        +parse(input: QTextStream): MeterList
        +serialize(data: MeterList): QString
    }

    class TxtFormat {
        +parse(input: QTextStream): MeterList override
        +serialize(data: MeterList): QString override
        -formatMeter(meter: AbstractMeter*): QString
        -parser: MeterParser
    }

    class CsvFormat {
        +parse(input: QTextStream): MeterList override
        +serialize(data: MeterList): QString override
        -formatMeter(meter: AbstractMeter*): QString
        -parser: MeterParser
    }

    class MeterParser {
        +parse(input: string): unique_ptr<AbstractMeter>
        -factory: MeterFactory
        -splitter: ISpliter*
        -dateParser: DateParser
        -valueParser: ValueParser
    }

    class ISpliter {
        <<interface>>
        +split(input: string) const: vector<string>
    }

    class StringSplitter {
        +split(input: string) const: vector<string>
    }

    class CsvSplitter {
        +split(input: string) const: vector<string>
    }

    class Validator {
        <<Utils>>
        +static isValidDateFormat(dateStr: string): bool
        +static isValidDateValues(year: int, month: int, day: int): bool
        +static isValidValue(valueStr: string): bool
        +static dateRegex(): regex
        +static valueRegex(): regex
    }

    class DateParser {
        +parse(input: string): Date
    }

    class ValueParser {
        +parse(input: string): float
    }

    class MeterFactory {
        +createMeter(type: string, date: Date, value: float, param: string): unique_ptr<AbstractMeter>
        -valueParser: ValueParser
    }

    class AbstractMeter {
        <<abstract>>
        +getDate(): Date
        +getValue(): float
        +toString(): string
    }

    class ElectricityMeter {
        +ElectricityMeter(date: Date, value: float, voltage: float)
        +getVoltage(): float
        +toString(): string
    }

    class WaterMeter {
        +WaterMeter(date: Date, value: float, isHot: bool)
        +isHot(): bool
        +toString(): string
    }

    class GasMeter {
        +GasMeter(date: Date, value: float, serialNumber: string)
        +getSerialNumber(): string
        +toString(): string
    }

    class MeterList {
        -meters: QVector<unique_ptr<AbstractMeter>>

        +addMeter(meter: unique_ptr<AbstractMeter>)
        +removeMeter(index: size_t)
        +clear()
        +size(): size_t
        +empty(): bool
    }

    class Date {
        +Date(year: int, month: int, day: int)
        +getYear(): int
        +getMonth(): int
        +getDay(): int
        +toString(): string
    }


    %% –°–≤—è–∑–∏ –º–µ–∂–¥—É –∫–ª–∞—Å—Å–∞–º–∏ 

    MainWindow --> AddMeterDialog : –≤—ã–∑—ã–≤–∞–µ—Ç –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏
    MainWindow --> MeterController : –∏—Å–ø–æ–ª—å–∑—É–µ—Ç
    MainWindow --> MeterListView : –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç
    %% MainWindow --> "QTableWidget*" : —Å–æ–¥–µ—Ä–∂–∏—Ç
    MainWindow --> FileHandler : –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏

    MeterController --> MeterList : —É–ø—Ä–∞–≤–ª—è–µ—Ç
    MeterController --> FileHandler : –∏—Å–ø–æ–ª—å–∑—É–µ—Ç
    MeterController --> AbstractMeter : —Å–æ–∑–¥–∞—ë—Ç —á–µ—Ä–µ–∑ —Ñ–∞–±—Ä–∏–∫—É

    MeterListView --> MeterList : –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç
    %% MeterListView --> "QTableWidget*" : —Å–æ–¥–µ—Ä–∂–∏—Ç

    AddMeterDialog --> AbstractMeter : —Å–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è

    FileHandler --> IFileFormat : –≤—ã–±–∏—Ä–∞–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é
    IFileFormat <|.. TxtFormat : —Ä–µ–∞–ª–∏–∑—É–µ—Ç
    IFileFormat <|.. CsvFormat : —Ä–µ–∞–ª–∏–∑—É–µ—Ç

    TxtFormat --> MeterParser : –∏—Å–ø–æ–ª—å–∑—É–µ—Ç
    CsvFormat --> MeterParser : –∏—Å–ø–æ–ª—å–∑—É–µ—Ç
    MeterParser --> ISpliter : –∏–º–µ–µ—Ç
    MeterParser --> StringSplitter : –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
    MeterParser --> CsvSplitter : –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
    MeterParser --> DateParser : –∏—Å–ø–æ–ª—å–∑—É–µ—Ç
    MeterParser --> ValueParser : –∏—Å–ø–æ–ª—å–∑—É–µ—Ç
    DateParser ..> Validator : –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–æ–¥—ã
    ValueParser ..> Validator : –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–æ–¥—ã
    MeterParser --> MeterFactory : –∏—Å–ø–æ–ª—å–∑—É–µ—Ç
    MeterFactory --> ValueParser : –∏—Å–ø–æ–ª—å–∑—É–µ—Ç
    AbstractMeter <|-- ElectricityMeter : –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è
    AbstractMeter <|-- WaterMeter : –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è
    AbstractMeter <|-- GasMeter : –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è
    MeterList *-- AbstractMeter : —Å–æ–¥–µ—Ä–∂–∏—Ç

    DateParser --> Date : —Å–æ–∑–¥–∞—ë—Ç
    AbstractMeter --> Date : —Å–æ–¥–µ—Ä–∂–∏—Ç

    note for MeterParser "–ü–∞—Ä—Å–∏—Ç —Å—Ç—Ä–æ–∫—É –≤ —Å—á—ë—Ç—á–∏–∫. –•—Ä–∞–Ω–∏—Ç —Ñ–∞–±—Ä–∏–∫—É –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä—Å–µ—Ä—ã."
    note for MeterFactory "–°–æ–∑–¥–∞—ë—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä—ã —Å—á—ë—Ç—á–∏–∫–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤."
    note for Validator "–ù–∞–±–æ—Ä —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Ç–æ–¥–æ–≤ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—Ç—Ä–æ–∫–∏, –∑–Ω–∞—á–µ–Ω–∏–π, –¥–∞—Ç –∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤."
```

---

## üîÑ –õ–æ–≥–∏–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤

### ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ:
1. `MainWindow` ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç `AddMeterDialog`
2. `AddMeterDialog` ‚Üí —Å–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
3. `MainWindow` ‚Üí —Å–æ–∑–¥–∞—ë—Ç –æ–±—ä–µ–∫—Ç `AbstractMeter` —á–µ—Ä–µ–∑ `MeterFactory`
4. `MainWindow` ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç `MeterController::addMeter()`
5. `MeterController` ‚Üí –¥–æ–±–∞–≤–ª—è–µ—Ç —Å—á—ë—Ç—á–∏–∫ –≤ `MeterList`
6. `MeterListView` ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–∞–±–ª–∏—Ü—É

### ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ:
1. `MainWindow` ‚Üí –ø–æ–ª—É—á–∞–µ—Ç –∏–Ω–¥–µ–∫—Å –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
2. `MainWindow` ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç `MeterController::removeMeter(index)`
3. `MeterController` ‚Üí —É–¥–∞–ª—è–µ—Ç —Å—á—ë—Ç—á–∏–∫ –∏–∑ `MeterList`
4. `MeterListView` ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–∞–±–ª–∏—Ü—É

---

## üíæ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏

### ‚úÖ –û—Ç–∫—Ä—ã—Ç–∏–µ —Ñ–∞–π–ª–∞:
1. `MainWindow` ‚Üí –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø—É—Ç—å —á–µ—Ä–µ–∑ `QFileDialog`
2. `MainWindow` ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç `MeterController::loadFromFile(path)`
3. `MeterController` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `FileHandler` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
4. `FileHandler` ‚Üí –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø —Ñ–∞–π–ª–∞ (`detectFormat`)
5. `FileHandler` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `IFileFormat` –¥–ª—è —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
6. `MeterList` ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
7. `MeterListView` ‚Üí –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

### ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞:
1. `MainWindow` ‚Üí –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø—É—Ç—å —á–µ—Ä–µ–∑ `QFileDialog` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ–∫—É—â–∏–π –ø—É—Ç—å
2. `MainWindow` ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç `MeterController::saveToFile(path)`
3. `MeterController` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `FileHandler` –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
4. `FileHandler` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `IFileFormat` –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

### ‚úÖ –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ:
1. `MainWindow` ‚Üí –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç `dragEnterEvent` –∏ `dropEvent`
2. –ü—Ä–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–∞ ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `on_loadBtn_clicked()`

### ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã—Ö–æ–¥–∞:
1. `MainWindow` ‚Üí –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç `closeEvent`
2. –ï—Å–ª–∏ `isModified == true` ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è `QMessageBox` —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è

---

## üìå –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:

| –≠–ª–µ–º–µ–Ω—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---------|------------|
| `AddMeterDialog` | –î–∏–∞–ª–æ–≥ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Å—á–µ—Ç—á–∏–∫–∞ |
| `deleteSelectedRow()` | –£–¥–∞–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –∏–∑ —Å–ø–∏—Å–∫–∞ |
| `isModified` | –§–ª–∞–≥ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –≤–ª–∏—è—é—â–∏–π –Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã—Ö–æ–¥–∞ |
| `dragEnterEvent`, `dropEvent` | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞ |
| `QMessageBox` | –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –≤—ã—Ö–æ–¥–æ–º |

---

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, –º–æ–≥—É:
- –ü–æ–∫–∞–∑–∞—Ç—å –∫–∞–∫ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç –≤ –∫–æ–¥–µ C++,
- –°–æ–∑–¥–∞—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç —Å —Ç–∞–∫–æ–π –∂–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π,
- –°–¥–µ–ª–∞—Ç—å –ø—Ä–∏–º–µ—Ä `main.cpp`.

–ì–æ—Ç–æ–≤ –ø–æ–º–æ—á—å!